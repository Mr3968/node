# 绘制立方体

- 为什么需要旋转矩阵去计算顶点的坐标值
  - 显示器上显示的实际上的平面的像素，可以简单理解为三维几何体放在你眼睛和显示器之间，集合体在显示器上的投影，视线一定的情况下，你看到的投影效果取决几何体的位置状态，如果你的视线沿着立方体的边线，投影就是一个平面的正方形，四条边线没有立体效果，你就要调正你看立方体的角度，那么问题来了，立方体 8 个顶点，如果让立方体的三条棱线和 xyz 轴重合，你可以很容易用 js 的数组写出他的坐标，假设立方体顶点是 WebGL 坐标系中的相对值 +-0.5，8 个顶点就是（+-0.5，+-0.5，+-0.5，），排列组合就可以，立方体相对 WebGL 坐标系如果是倾斜放的（棱线与坐标轴不重合），你就需要算出当前 8 个顶点的坐标值，立方体还算规则，如果一张人脸上千甚至更多的顶点坐标怎么办？这个时候算法上就需要矩阵乘法运算来辅助，对于旋转而言就是旋转矩阵，对于硬件而言就是需要 GPU，大规模并行处理顶点数据。

## 着色器内置函数

- radians()

  - 角度值转化为弧度制，参数是浮点数，比如 30 度时，要写成 30.0

- cos()

  - 余弦函数 参数要求是弧度值求是浮点数

- sin()
  - 正弦函数 参数要求是弧度制且是浮点数

## 代码执行流程

- data 变量定义的顶点数据初始化时，会存入内存中，
- 执行 gl.bindBuffer（gl.ARRAY_BUFFER,buffer）内存中的数据一次性传入显存缓存区中，传入缓冲区中的顶点数据 可以通过 drawArrays 方法多次调用 每次 drawArrays 方法调用，顶点经过渲染管线得到的像素相关数据都会存入帧缓存中，后一次调用，前一次调用生成的像素数据不会清空，最终形成一副完整的立方体线框图

## 总结

- 如果几何体经过多次旋转可以把每一次的旋转矩阵，连续进行乘法运算，最后再左乘顶点的齐次坐标

- 旋转变换和平移变换同时存在，旋转矩阵和平移矩阵一样都是四阶矩阵，因此同样可以先进行乘法运算得到的是四阶矩阵，最后再左乘顶点的齐次坐标，这种情况也就是复合变换

# 顶点索引绘制立方体

- 再普通绘制的时候 一条直线需要定义两个顶点 而立方体中一个顶点被多条直线所使用 所以我们可以把立方体的 8 个顶点声明再一个数组中，再声明一个索引数组可以多次调用同一个顶点，这样可以复用数据，节约空间

```
let arr = [(0.5,0.5,0.5),(-0.5,0.5,0.5),(-0.5, -0.5, 0.5),(0.5, -0.5, 0.5),	(0.5, 0.5, -0.5),	(-0.5, 0.5, -0.5),	(-0.5, -0.5, -0.5),	(0.5, -0.5, -0.5)]

let index = new Unit8Array([
// 前四个点所对应的索引值
0,1,2,3,
// 后四个点所对应的索引值
4,5,6,7,
// 前后对应点对应的索引值 两个点绘制一条直线
0,4,
1,5,
2,6,
3,7
])
```

- WebGL 为了复用顶点数据新引入了一个新的绘制函数 gl.drawElements(), gl.drawElements()和 gl.drawArrays()方法一样都是命令浏览器 WebGL 推行系统开始处理顶点绘制渲染出像素并显示再屏幕 Canvas 画布上。区别是 gl.drawArray()是直接调用顶点数组数据，gl.drawElements()是通过一个索引数组访问使用顶点数组中的顶点数据

- 索引数组的数据传入显存缓冲区，注意与顶点数据传入缓存区方法参数的对比，传入索引数据时，bindBuffer()和 bufferDate()方法的第一个参数是 gl.ELEMENT_ARRAY_BUFFER,传入顶点数据时是 gl.ARRAY_BUFFER，传入顶点数据时是 gl.ARRAY_BUFFER。

- 使用方法 drawElements() 替换 drawArrays()方法，参数设置基本一致，方法 drawElements() 只是新增了一个数据类型设置参数 gl.UNSIGNED_BYTE。 新增参数是第三个参数

```
gl.drawArrays(gl.LINES, 8, 8);
gl.drawElements(gl.LINES, 8, gl.UNSIGNED_BYTE, 8);
```

- gl.drawElements()

  - 参数格式：drawElements( mode,count,type,offset )
  - mode: 绘制模式 值：gl.LINE_LOOP、gl.LINES、gl.TRIANGLES 等
  - count: 绘制顶点个数 值： 整形数
  - type: 数据类型 值：gl.UNSIGNED_BYTE 对应 Uint8Array，gl.UNSIGNED_SHORT 对应 Uint16Array
  - offset: 从第几个点开始绘制 值： 整形数，以字节为单位
  - count 和 offset 组合可以确定绘制众多顶点中的连续一段，通过顶点索引关联顶点数据，count 和 offset 指的是顶点的索引数组。
